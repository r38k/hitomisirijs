# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is an Astro blog application deployed to Cloudflare Pages. It's based on the Astro blog starter template with Cloudflare adapter integration.

## Development Commands

```bash
# Install dependencies
pnpm install

# Start dev server (localhost:4321)
pnpm dev

# Build for production
pnpm build

# Preview build locally with Wrangler
pnpm preview

# Deploy to Cloudflare Pages
pnpm deploy

# Generate Cloudflare Workers types
pnpm cf-typegen
```

## Architecture

### Project Structure

- `src/pages/` - File-based routing. `.astro` and `.md` files become routes
- `src/content/blog/` - Blog posts as Markdown/MDX files, managed by Astro Content Collections
- `src/layouts/` - Layout components (BlogPost layout wraps blog content)
- `src/components/` - Reusable Astro components
- `public/` - Static assets served as-is

### Key Architectural Patterns

**Content Collections**: Blog posts use Astro's Content Collections API defined in `src/content.config.ts`. The schema enforces frontmatter structure (title, description, pubDate, updatedDate, heroImage). Access posts via `getCollection('blog')`.

**Dynamic Routing**: Blog posts use `[...slug].astro` catch-all route at `src/pages/blog/[...slug].astro`. The `getStaticPaths()` function generates routes from the blog collection at build time.

**RSS Feed**: Generated dynamically at `/rss.xml` via `src/pages/rss.xml.js` using `@astrojs/rss` and the blog collection.

**Cloudflare Integration**:

- Uses `@astrojs/cloudflare` adapter with SSR mode
- Platform proxy enabled for local development
- Cloudflare Image Service configured
- Runtime types defined in `src/env.d.ts` for `App.Locals`
- Cloudflare Workers types referenced in `tsconfig.json` via `worker-configuration.d.ts`

**Global Constants**: Site metadata (SITE_TITLE, SITE_DESCRIPTION) stored in `src/consts.ts` and imported where needed.

**Styling**: Global CSS in `src/styles/global.css` imported via BaseHead component. Individual components use scoped styles.

**Language**: HTML lang attribute set to "ja" (Japanese) in layout files.

## Content Management

To add a new blog post:

1. Create a `.md` or `.mdx` file in `src/content/blog/`
2. Include required frontmatter: `title`, `description`, `pubDate`
3. Optional: `updatedDate`, `heroImage`
4. The file name becomes the post slug

## Deployment

The site deploys to Cloudflare Pages via Wrangler. The build output (`./dist/`) is generated by `astro build` and deployed with `wrangler deploy`.

Update the `site` field in `astro.config.mjs` from '<https://example.com>' to your actual domain for correct canonical URLs and sitemaps.

## Git Conventions

Write commit messages in Japanese.
